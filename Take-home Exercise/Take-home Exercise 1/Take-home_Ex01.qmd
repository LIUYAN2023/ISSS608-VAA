---
title: "Take-home_Ex01"
author: "LIU YAN"
date: "14 May 2023"
editor: visual
---

# 1. Overview

City of Engagement, with a total population of 50,000, is a small city located at Country of Nowhere. The city serves as a service centre of an agriculture region surrounding the city. The main agriculture of the region is fruit farms and vineyards. The local council of the city is in the process of preparing the Local Plan 2023. A sample survey of 1000 representative residents had been conducted to collect data related to their household demographic and spending patterns, among other things. The city aims to use the data to assist with their major community revitalization efforts, including how to allocate a very large city renewal grant they have recently received.

In this take-home exercise, you are required to apply the concepts and methods you had learned in Lesson 1-4 to reveal the demographic and financial characteristics of the city of Engagement byusing appropriate static and interactive statistical graphics methods. This exercise requires a user-friendly and interactive solution that helps city managers and planners to explore the complex data in an engaging way and reveal hidden patterns.

# 2. Data Preparation

## 2.1  Install R packages and import dataset

The code chunk below uses pacman::p_load() to check if packages are installed. If they are, they will be launched into R. The packages installed are

plotly: Used for creating interactive web-based graphs.

ggstatsplot: Used for creating graphics with details from statistical tests.

knitr: Used for dynamic report generation

pacthwork: Used to combine plots

ggdist: Used for visualising distribution and uncertainty

ggthemes: Provide additional themes for ggplot2

tidyverse: A collection of core packages designed for data science, used extensively for data preparation and wrangling.

All packages can be found within CRAN.

```{r}
#Load packages
pacman::p_load(plotly, ggstatsplot, knitr, patchwork, ggdist, ggthemes, tidyverse)

```

Import data from csv using readr::read_csv() and store it in variable `FinancialJournal` and `Participants`.

```{r}
#Import data
FinancialJournal <- read_csv("data/FinancialJournal.csv", show_col_types = FALSE)

Participants <- read_csv("data/Participants.csv", show_col_types = FALSE)
```

## 2.2  Data Introduction

For the purpose of this study, two data sets are provided. They are:

Participants.csv

Contains information about the residents of City of Engagement that have agreed to participate in this study.

participantId (integer): unique ID assigned to each participant.
householdSize (integer): the number of people in the participant’s household
haveKids (boolean): whether there are children living in the participant’s household.
age (integer): participant’s age in years at the start of the study.
educationLevel (string factor): the participant’s education level, one of: {“Low”, “HighSchoolOrCollege”, “Bachelors”, “Graduate”}
interestGroup (char): a char representing the participant’s stated primary interest group, one of {“A”, “B”, “C”, “D”, “E”, “F”, “G”, “H”, “I”, “J”}. Note: specific topics of interest have been redacted to avoid bias.
joviality (float): a value ranging from [0,1] indicating the participant’s overall happiness level at the start of the study.
FinancialJournal.csv

Contains information about financial transactions.

participantId (integer): unique ID corresponding to the participant affected
timestamp (datetime): the time when the check-in was logged
category (string factor): a string describing the expense category, one of {“Education”, “Food”, “Recreation”, “RentAdjustment”, “Shelter”, “Wage”}
amount (double): the amount of the transaction


## 3. Data Prepration and Wrangling

### 3.1 Install R Packages

```{r}
pacman::p_load(patchwork, tidyverse, rstatix, gt,ggstatsplot, ggdist, gganimate, png, gifski, nortest)
```

### 3.2 Loading the Dataset

```{r}

FinancialJournal <- read_csv("data/FinancialJournal.csv")
Participants <- read_csv("data/Participants.csv")

```

### 3.3 Data Cleaning and Wrangling

#### 3.3.1 Data Issue

| Item |                             Issue                             |                           Solution                           |
|:-------------:|:-------------------------:|:----------------------------------------:|
|  1   |                        wrong data type                        |         modify all the variable to correct data type         |
|  2   |          "RentAdjustment" is part of "shelter" cost           |       replace all the "RentAdjustment" with "shelter"        |
|  3   |             "timestamp" format is too complicated             |                change "timestamp" to "month"                 |
|  4   |           there are 1,113 rows data are duplicates            | remove all duplicate rows in the FinancialJournal data table |
|  5   | 131 nos of participantId only have less than 12 months record |       remove the rows with less than 12 months record        |

```{r}

# 1.Modify the data type###########################################################

# Convert participantId from numeric to integer
FinancialJournal$participantId <- as.integer(FinancialJournal$participantId)

# Convert category from character to string factor with specified levels
FinancialJournal$category <- factor(FinancialJournal$category, levels = c("Education", "Food", "Recreation", "RentAdjustment", "Shelter", "Wage"))

# Convert amount from numeric to double
FinancialJournal$amount <- as.double(FinancialJournal$amount)

# Convert participantId from numeric to integer
Participants$participantId <- as.integer(Participants$participantId)

# Convert householdSize from numeric to integer
Participants$householdSize <- as.integer(Participants$householdSize)

# Convert haveKids from logical to Boolean
Participants$haveKids <- as.logical(Participants$haveKids)

# Convert age from numeric to integer
Participants$age <- as.integer(Participants$age)

# Convert educationLevel from character to string factor with specified levels
Participants$educationLevel <- factor(Participants$educationLevel, levels = c("Low", "HighSchoolOrCollege", "Bachelors", "Graduate"))

# Convert joviality from numeric to float
Participants$joviality <- as.double(Participants$joviality)


# 2. Replace all the "RentAdjustment" with "shelter"###############################

FinancialJournal$category <- factor(ifelse(FinancialJournal$category == "RentAdjustment", "Shelter", as.character(FinancialJournal$category)))

# 3. Extract new variable month from the timestamp#################################

FinancialJournal <- FinancialJournal %>%
  mutate(month = month(FinancialJournal$timestamp))


# 4. Remove all duplicate rows in the FinancialJournal#############################

# Check duplicate rows in the FinancialJournal data table
sum(duplicated(FinancialJournal))

# Remove all duplicate rows in the FinancialJournal
FinancialJournal <- distinct(FinancialJournal)


# 5. remove the rows with less than 12 months record###############################

# check the row with less than 12 months record
FinancialJournal %>% 
  group_by(participantId) %>% 
  filter(n_distinct(month) < 12) %>% 
  distinct(participantId)

# remove the rows with less than 12 months record
FinancialJournal %>%
  group_by(participantId) %>%
  mutate(month_count = n_distinct(month)) %>%
  filter(month_count >= 12) %>%
  select(-month_count) -> FinancialJournal
```

#### 3.3.2 Reshape FinancialJournal and Data Table Join

```{r}
# Group the rows of the "FinancialJournal" data table by "participantId" and "category"
Financial_sum <- FinancialJournal %>%
  group_by(participantId, category) %>%
  summarise(average_amount = sum(amount)/12) 


# Reshape the Financial_sum and make each "category" becomes a separate column 
Financial_wide <- Financial_sum %>%
  spread(category, average_amount)


# Join the two Participants and Financial_wide by participantId

joined_table <- Participants %>% 
                inner_join(Financial_wide, by = "participantId")

```

#### 3.3.3 New Variable Wrangling

```{r}

# Create new columns "Total_Expenditure" and "Saving_Ratio"
joined_table <- joined_table %>%
  mutate(across(c(Education, Food, Recreation, Shelter), ~replace_na(., 0)),
        Total_Expenditure = (Education + Food + Recreation + Shelter),
        Saving_Ratio =( (Wage + Total_Expenditure)/Wage))
        
# Create age_bin column
joined_table$age_bin <- cut(joined_table$age, 
                            breaks = c(-Inf, 30, 40, 50, Inf),
                            labels = c("<=30", ">30-40", ">40-50", ">50"))

# Create Wage_bin column
joined_table$Wage_bin <- cut(joined_table$Wage,
                             breaks = c(-Inf, 3000, 4000, 5000, Inf),
                             labels = c("<3000", "3000-<4000", "4000-<5000", ">=5000"))

joined_table
```

## 3.1 Exploratory Data Visualisation
## 3.2 Confirmatory Data Analysis Visualisation
## 3.3 Visualising the uncertainty of point estimates
## 3.4 Visualising the uncertainty of point estimates